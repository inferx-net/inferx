apiVersion: v1
kind: Pod
metadata:
  name: inferx-debugone
spec:
  tolerations:
    - key: "node.coreweave.cloud/reserved"
      operator: "Exists"
      effect: "NoExecute"  
  containers:
    - name: debug
      image: inferx/inferx_one:v0.1.2
      imagePullPolicy: Always
      command: ["sleep", "infinity"]
      securityContext:
        privileged: true
      env:
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: INFERX_ADMIN_APIKEY
          value: "87831cdb-d07a-4dc1-9de0-fb232c9bf286"
        - name: ALLOC_MEMORY
          value: "180Gi"
        - name: ALLOC_CPU
          value: "24"
        - name: CACHE_MEMORY
          value: "40Gi"
        - name: ENABLE_2MB_PAGE
          value: "false"
        - name: ENALBE_BLOB
          value: "false"
        - name: BLOB_BUFF
          value: "4Gi"
      resources:
        limits:
          nvidia.com/gpu: 8 # use all available GPUs
          cpu: "20"
      volumeMounts:
        - name: run-udev
          mountPath: /run/udev
          mountPropagation: Bidirectional
        - name: hugepages
          mountPath: /dev/hugepages
          mountPropagation: Bidirectional
        - name: shm
          mountPath: /dev/shm
          mountPropagation: Bidirectional
        - name: inferx-opt
          mountPath: /opt/inferx/
          mountPropagation: Bidirectional
        - name: cache
          mountPath: /opt/inferx/cache/
          mountPropagation: Bidirectional
        - name: certs
          mountPath: /etc/letsencrypt/
          mountPropagation: Bidirectional
        - name: dind
          mountPath: /var/lib/docker
          mountPropagation: Bidirectional
        - name: runc
          mountPath: /var/run/docker/runtime-runc/moby/
          mountPropagation: Bidirectional
        - name: host-root
          mountPath: /host
          mountPropagation: Bidirectional
  volumes:
    - name: run-udev
      hostPath:
        path: /run/udev
    - name: hugepages
      hostPath:
        path: /dev/hugepages
    - name: shm
      hostPath:
        path: /dev/shm
    - name: inferx-opt
      hostPath:
        path: /opt/inferx/
    - name: cache
      hostPath:
        path: /opt/inferx/cache/
    - name: certs
      hostPath:
        path: /etc/letsencrypt/
    - name: dind
      hostPath:
        path: /opt/inferx/dind
    - name: runc
      hostPath:
        path: /var/run/docker/runtime-runc/moby/
    - name: host-root
      hostPath:
        path: /

